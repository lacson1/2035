<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prescription Print Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    button {
      padding: 10px 20px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #1e40af;
    }
    .test-result {
      margin-top: 10px;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>Prescription Print Functionality Test</h1>
  
  <div class="test-section">
    <h2>Test Organization Utility</h2>
    <button onclick="testOrganization()">Test Organization Header/Footer</button>
    <div id="org-result" class="test-result"></div>
  </div>

  <div class="test-section">
    <h2>Test Prescription Print</h2>
    <p>This will simulate the prescription print functionality with sample data.</p>
    <button onclick="testPrescriptionPrint()">Test Print Prescription</button>
    <div id="print-result" class="test-result"></div>
  </div>

  <script>
    // Mock organization utility
    const DEFAULT_ORGANIZATION = {
      name: "Bluequee2.0 Medical Center",
      type: "Medical Center",
      address: "123 Medical Drive",
      city: "Springfield",
      state: "IL",
      zipCode: "62701",
      phone: "(217) 555-0100",
      fax: "(217) 555-0101",
      email: "info@bluequee2.com",
    };

    function getOrganizationHeader() {
      const org = DEFAULT_ORGANIZATION;
      return `${org.name}\n${org.type}\n${org.address}, ${org.city}, ${org.state} ${org.zipCode}\nPhone: ${org.phone}${org.fax ? ` | Fax: ${org.fax}` : ""}${org.email ? ` | Email: ${org.email}` : ""}`;
    }

    function getOrganizationFooter() {
      const org = DEFAULT_ORGANIZATION;
      return `${org.name} | ${org.address}, ${org.city}, ${org.state} ${org.zipCode} | ${org.phone}`;
    }

    function testOrganization() {
      const header = getOrganizationHeader();
      const footer = getOrganizationFooter();
      document.getElementById('org-result').innerHTML = `
        <strong>Header:</strong><br>
        <pre>${header}</pre><br>
        <strong>Footer:</strong><br>
        <pre>${footer}</pre>
      `;
    }

    function testPrescriptionPrint() {
      const resultDiv = document.getElementById('print-result');
      resultDiv.innerHTML = 'Opening print window...';
      
      try {
        // Sample patient data
        const patient = {
          name: "Ava Mensah",
          dob: "1972-06-15",
          allergies: ["Penicillin", "Sulfa drugs"]
        };

        const activeMeds = [
          {
            name: "Metformin 1000mg BID",
            status: "Active",
            started: "2025-09-13",
            instructions: "Take with meals, twice daily"
          },
          {
            name: "Lisinopril 10mg QD",
            status: "Active",
            started: "2025-09-16",
            instructions: "Take once daily in the morning"
          }
        ];

        const orgHeader = getOrganizationHeader();
        const orgFooter = getOrganizationFooter();
        const orgHeaderLines = orgHeader.split('\n');
        const orgName = orgHeaderLines[0] || '';
        const orgType = orgHeaderLines[1] || '';
        const orgDetails = orgHeaderLines.slice(2).join('<br>');

        // Build medications HTML
        let medicationsHtml = '';
        if (activeMeds.length > 0) {
          medicationsHtml = activeMeds.map((med) => {
            const startDate = med.started ? new Date(med.started).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : '';
            const duration = med.started ? Math.floor((Date.now() - new Date(med.started).getTime()) / (1000 * 60 * 60 * 24)) : 0;
            const instructions = med.instructions || '';
            
            let medHtml = `
              <div class="medication-item">
                <div class="medication-name">
                  <span class="rx-symbol">℞</span>${med.name.replace(/</g, '&lt;').replace(/>/g, '&gt;')}
                </div>
                <div class="medication-details">`;
            
            if (startDate) {
              medHtml += `<div><strong>Started:</strong> ${startDate}</div>`;
            }
            
            if (duration > 0) {
              medHtml += `<div><strong>Duration:</strong> ${duration} days</div>`;
            }
            
            if (instructions) {
              medHtml += `
                <div class="instructions-box">
                  <strong>Instructions:</strong><br>
                  ${instructions.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>')}
                </div>`;
            }
            
            medHtml += `
                </div>
              </div>`;
            
            return medHtml;
          }).join('');
        }

        const patientName = (patient.name || 'Unknown Patient').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        const patientDob = patient.dob ? new Date(patient.dob).toLocaleDateString() : 'N/A';
        const currentDate = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        const allergies = patient.allergies && patient.allergies.length > 0 
          ? patient.allergies.join(', ').replace(/</g, '&lt;').replace(/>/g, '&gt;')
          : 'None known';
        const generatedDate = new Date().toLocaleString('en-US', { dateStyle: 'long', timeStyle: 'short' });

        const printContent = `<!DOCTYPE html>
<html>
<head>
  <title>Prescription - ${patientName}</title>
  <style>
    @page {
      margin: 0.75in;
      size: letter;
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 800px;
      margin: 0 auto;
      padding: 0;
    }
    .org-header {
      border-bottom: 3px solid #2563eb;
      padding-bottom: 15px;
      margin-bottom: 25px;
      text-align: center;
    }
    .org-name {
      font-size: 22px;
      font-weight: 700;
      color: #1e40af;
      margin: 0 0 5px 0;
    }
    .org-type {
      font-size: 14px;
      color: #4b5563;
      margin: 0 0 8px 0;
      font-weight: 500;
    }
    .org-details {
      font-size: 11px;
      color: #6b7280;
      line-height: 1.5;
      margin: 0;
    }
    .document-header {
      text-align: center;
      margin: 25px 0;
      padding-bottom: 15px;
      border-bottom: 2px solid #e5e7eb;
    }
    .document-header h1 {
      margin: 0;
      font-size: 20px;
      color: #1e40af;
      font-weight: 600;
    }
    .document-header h2 {
      margin: 8px 0 0 0;
      font-size: 16px;
      color: #4b5563;
      font-weight: normal;
    }
    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 25px 0;
    }
    .info-item {
      padding: 10px;
      background: #f9fafb;
      border-radius: 4px;
      border: 1px solid #e5e7eb;
    }
    .info-label {
      font-size: 10px;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
      font-weight: 600;
    }
    .info-value {
      font-size: 13px;
      font-weight: 600;
      color: #111827;
    }
    .medications-section {
      margin: 30px 0;
    }
    .medication-item {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-left: 4px solid #2563eb;
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 15px;
    }
    .medication-name {
      font-size: 16px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 8px;
    }
    .medication-details {
      font-size: 13px;
      color: #4b5563;
      line-height: 1.8;
    }
    .medication-details strong {
      color: #111827;
    }
    .instructions-box {
      background: #eff6ff;
      border-left: 3px solid #2563eb;
      padding: 12px;
      margin-top: 10px;
      border-radius: 4px;
    }
    .instructions-box strong {
      color: #1e40af;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
      font-size: 10px;
      color: #6b7280;
      text-align: center;
    }
    .signature-section {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
    }
    .signature-line {
      margin-top: 50px;
      border-top: 1px solid #333;
      width: 300px;
    }
    .signature-label {
      font-size: 11px;
      color: #6b7280;
      margin-top: 5px;
    }
    .rx-symbol {
      font-size: 24px;
      color: #2563eb;
      margin-right: 10px;
    }
    @media print {
      .no-print {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="org-header">
    <div class="org-name">${orgName}</div>
    <div class="org-type">${orgType}</div>
    <div class="org-details">${orgDetails}</div>
  </div>

  <div class="document-header">
    <h1>PRESCRIPTION</h1>
    <h2>Medication List</h2>
  </div>

  <div class="info-grid">
    <div class="info-item">
      <div class="info-label">Patient Name</div>
      <div class="info-value">${patientName}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Date of Birth</div>
      <div class="info-value">${patientDob}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Date</div>
      <div class="info-value">${currentDate}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Allergies</div>
      <div class="info-value">${allergies}</div>
    </div>
  </div>

  <div class="medications-section">
    <h3 style="font-size: 16px; font-weight: 600; color: #1e40af; margin-bottom: 20px; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">
      Active Medications (${activeMeds.length})
    </h3>
    ${medicationsHtml}
  </div>

  <div class="signature-section">
    <div class="signature-line"></div>
    <div class="signature-label">Prescribing Physician Signature</div>
  </div>

  <div class="footer">
    <div>Generated: ${generatedDate}</div>
    <div style="margin-top: 5px;">${orgFooter}</div>
    <div style="margin-top: 5px; font-size: 9px;">This is a prescription document. Please present this to your pharmacist.</div>
    <div style="margin-top: 5px; font-size: 9px;">Confidential Medical Document - For Authorized Personnel Only</div>
  </div>
</body>
</html>`;

        const printWindow = window.open('', '_blank');
        if (!printWindow) {
          resultDiv.innerHTML = '<span style="color: red;">Error: Pop-up blocked. Please allow pop-ups for this site.</span>';
          return;
        }

        printWindow.document.write(printContent);
        printWindow.document.close();
        printWindow.focus();
        
        setTimeout(() => {
          try {
            printWindow.print();
            resultDiv.innerHTML = '<span style="color: green;">✓ Print window opened successfully! Check your printer dialog.</span>';
          } catch (error) {
            resultDiv.innerHTML = `<span style="color: red;">Error printing: ${error.message}</span>`;
          }
        }, 500);
      } catch (error) {
        resultDiv.innerHTML = `<span style="color: red;">Error: ${error.message}</span>`;
        console.error('Test error:', error);
      }
    }
  </script>
</body>
</html>

